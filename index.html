<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ISA Cultural Fest 2026 | The Legacy</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Instrument+Serif:ital@0;1&family=Inter:wght@200;300;400&family=Bodoni+Moda:ital,wght@0,400;1,700&display=swap" rel="stylesheet">
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
:root{
  /* üå∏ Pastel Royal (light, airy) */
  --blue: #ECF3FF;
  --lavender: #F3EEFF;
  --violet: #ECE6FA;
  --sky: #FAFBFF;

  --gold: #C9B26D;
  --gold-soft: rgba(201,178,109,.42);

  --ink: #2A2A3A;
  --muted: #6B6B85;

  --glass: rgba(255,255,255,.72);
  --glass-2: rgba(255,255,255,.86);

  --border: rgba(201,178,109,.35);
  --border-soft: rgba(30,30,60,.10);

  --radius: 26px;
  --radius-sm: 18px;
  --shadow: 0 30px 80px rgba(120,110,160,.20);
  --shadow-soft: 0 16px 40px rgba(120,110,160,.14);

  --ease: cubic-bezier(.19,1,.22,1);
}

*{ box-sizing:border-box; }

html, body{
  margin:0;
  font-family: Inter, system-ui, sans-serif;
  color: var(--ink);
  background: linear-gradient(
    180deg,
    var(--blue) 0%,
    var(--lavender) 35%,
    var(--violet) 70%,
    var(--sky) 100%
  );
}

body::after{
  /* subtle paper grain */
  content:"";
  position:fixed;
  inset:0;
  background-image:
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='2'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.08'/%3E%3C/svg%3E");
  pointer-events:none;
}

.container{
  width:min(1120px, calc(100% - 48px));
  margin:0 auto;
}
@media(max-width:800px){
  .container{ width:min(1120px, calc(100% - 28px)); }
}

/* HERO */
.hero{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding: 40px 0;
}
.hero-label{
  font-family: Syncopate;
  font-size:11px;
  letter-spacing:.5rem;
  text-transform:uppercase;
  color: var(--muted);
  margin: 0 0 22px;
}
.hero-title{
  font-family:"Instrument Serif", serif;
  font-size:clamp(3.4rem, 12vw, 9rem);
  font-style:italic;
  margin:0;
  line-height:.9;
  background: linear-gradient(180deg, #E7DBB5, #C9B26D);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}
.hero-sub{
  margin:18px auto 0;
  font-weight:300;
  max-width:60ch;
  color: var(--muted);
  line-height: 1.65;
}

/* REGISTRY */
.registry{
  padding:120px 0 80px;
}
.card{
  background: var(--glass);
  border-radius: var(--radius);
  border:1px solid var(--border);
  box-shadow: var(--shadow);
  padding: clamp(28px, 5vw, 72px);
  backdrop-filter: blur(14px);
}
.card h2{
  font-family:"Bodoni Moda", serif;
  font-style:italic;
  font-size:clamp(2rem, 3vw, 3rem);
  text-align:center;
  margin:0;
}
.card p{
  text-align:center;
  color: var(--muted);
  margin: 14px auto 42px;
  max-width: 72ch;
  line-height: 1.6;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:28px;
}
@media(max-width:800px){
  .grid{ grid-template-columns:1fr; }
}
.field{
  padding:18px 20px;
  border-radius: var(--radius-sm);
  background: var(--glass-2);
  border:1px solid var(--border-soft);
  box-shadow: var(--shadow-soft);
}
.field label{
  display:block;
  font-family:Syncopate;
  font-size:10px;
  letter-spacing:.3rem;
  color: var(--muted);
  margin-bottom:12px;
  text-transform: uppercase;
}
input, select, textarea{
  width:100%;
  border:none;
  background:transparent;
  border-bottom:1px solid rgba(0,0,0,.18);
  font-family:Inter;
  font-size:1rem;
  padding:8px 2px;
  outline:none;
  color: var(--ink);
}
textarea{
  resize:none;
  min-height:74px;
  line-height:1.55;
}
input:focus, select:focus, textarea:focus{
  border-bottom-color: var(--gold);
}
::placeholder{ color: rgba(42,42,58,.38); }

button.primary{
  width:100%;
  margin-top:36px;
  padding:22px;
  border-radius:999px;
  border:1px solid var(--gold);
  background: linear-gradient(180deg, #FFF7DC, #E6D29A);
  font-family:Syncopate;
  font-size:11px;
  letter-spacing:.4rem;
  cursor:pointer;
  transition:.4s var(--ease);
}
button.primary:hover:not(:disabled){
  transform:translateY(-2px);
  box-shadow:0 20px 40px rgba(201,178,109,.30);
}
button.primary:disabled{
  opacity:.55;
  cursor:not-allowed;
}
.status{
  text-align:center;
  font-size:11px;
  letter-spacing:.2rem;
  color: var(--muted);
  margin-top:18px;
  text-transform: uppercase;
}

/* FEED */
.feed{
  padding:80px 0 120px;
}
.feed-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  gap:16px;
  margin-bottom:24px;
  flex-wrap: wrap;
}
.feed-title{
  font-family:"Bodoni Moda", serif;
  font-style: italic;
  font-size: clamp(1.6rem, 2.6vw, 2.2rem);
  margin:0;
}
.searchWrap{
  flex: 0 1 460px;
  padding: 14px 18px;
  border-radius: 999px;
  background: rgba(255,255,255,.75);
  border: 1px solid var(--border-soft);
  box-shadow: var(--shadow-soft);
}
.searchWrap input{
  border-bottom: none;
  padding: 6px 10px;
}

.feed-item{
  background: rgba(255,255,255,.78);
  border-radius: var(--radius);
  border:1px solid var(--border);
  box-shadow: var(--shadow);
  padding: 34px;
  margin-bottom: 22px;
  text-align:center;
}
.meta{
  font-family:Syncopate;
  font-size:10px;
  letter-spacing:.3rem;
  color: var(--muted);
  margin-bottom:18px;
  text-transform: uppercase;
}
.quote{
  font-family:"Instrument Serif", serif;
  font-size:clamp(1.6rem, 4vw, 2.6rem);
  font-style:italic;
  margin: 0 0 18px;
  white-space: pre-wrap;
  word-break: break-word;
}
.sig{
  font-family:"Bodoni Moda", serif;
  letter-spacing:.12rem;
  color: var(--muted);
}
.actions{
  margin-top: 18px;
  display:flex;
  justify-content:center;
  gap:10px;
}
button.redact{
  padding: 10px 16px;
  border-radius: 999px;
  border: 1px solid rgba(205, 85, 85, .35);
  background: rgba(205, 85, 85, .10);
  color: #B24C4C;
  font-family: Syncopate;
  font-size: 10px;
  letter-spacing: .18rem;
  cursor: pointer;
  transition: .3s var(--ease);
}
button.redact:hover{
  transform: translateY(-1px);
  background: rgba(205, 85, 85, .14);
}
.smallNote{
  margin-top: 10px;
  font-size: 12px;
  color: var(--muted);
  text-align:center;
}
</style>
</head>

<body>

<section class="hero">
  <div class="container">
    <div class="hero-label">The Sovereign Estate of</div>
    <h1 class="hero-title">ISA Cultural Fest</h1>
    <p class="hero-sub">A pastel archive of gratitude ‚Äî refined, gentle, and preserved as legacy.</p>
    <div class="hero-label" style="margin-top:34px;">MMXXVI Chronicles</div>
  </div>
</section>

<section class="registry">
  <div class="container">
    <div class="card">
      <h2>The Imperial Registry</h2>
      <p>
        Authenticate to leave a testimony. Your name will <b>not</b> be shown unless you type a signature.
        Only the author may delete their own entry.
      </p>

      <div id="g_id_onload"
        data-client_id="671163289983-2056vpimutuatgerek6676pr1ob9p1n0.apps.googleusercontent.com"
        data-callback="handleCredentialResponse"
        data-auto_prompt="false"></div>

      <div class="g_id_signin" style="display:flex;justify-content:center;margin-bottom:36px;"></div>

      <div class="grid">
        <div class="field">
          <label for="from">Origin Department</label>
          <select id="from"></select>
        </div>

        <div class="field">
          <label for="to">Destined Department</label>
          <select id="to"></select>
        </div>

        <div class="field">
          <label for="recipient">The Recipient</label>
          <input id="recipient" placeholder="Name of the distinguished..." autocomplete="off" />
        </div>

        <div class="field">
          <label for="signature">Signature (optional)</label>
          <input id="signature" placeholder="Leave blank to remain unnamed" autocomplete="off" />
        </div>

        <div class="field">
          <label for="search">Archive Search</label>
          <input id="search" placeholder="Recall a memory..." autocomplete="off" />
        </div>

        <div class="field" style="grid-column:1/-1;">
          <label for="msg">The Testimony</label>
          <textarea id="msg" placeholder="Compose your legacy..."></textarea>
        </div>
      </div>

      <button class="primary" id="submit" disabled>ETCH INTO HISTORY</button>
      <div id="status" class="status">Authentication required</div>
      <div class="smallNote">Tip: If you want privacy, leave ‚ÄúSignature‚Äù blank.</div>
    </div>
  </div>
</section>

<section class="feed">
  <div class="container">
    <div class="feed-head">
      <h3 class="feed-title">The Gallery of Testimonies</h3>
      <div class="searchWrap">
        <input id="search2" placeholder="Search the archive..." autocomplete="off" />
      </div>
    </div>
    <div id="feed"></div>
  </div>
</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* =========================
   Firebase
========================= */
firebase.initializeApp({
  apiKey: "AIzaSyBfj4i0quFWPTHCdnC8GT3BSEsKvvvqzRA",
  authDomain: "isa-culturtal-fest-2026.firebaseapp.com",
  databaseURL: "https://isa-culturtal-fest-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "isa-culturtal-fest-2026"
});
const db = firebase.database();

/* =========================
   Roles
========================= */
const roles = [
  "PR", "Finance (Sponsorship)", "Co-Presidents", "Helpers",
  "Activity Booth Hosts", "Activity Performers", "Activity Team",
  "HR Coordination", "HR Operation", "Secretary",
  "Lighting & Sound Crew", "Attendees", "Core Council", "Ambassadors"
];
roles.forEach(r => {
  document.getElementById("from").add(new Option(r, r));
  document.getElementById("to").add(new Option(r, r));
});

/* =========================
   Auth (for delete ownership)
   Note: this is UI-level ownership based on Google One Tap "sub".
========================= */
let currentUser = null;

function decodeJwt(token){
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
  return JSON.parse(atob(base64));
}
function handleCredentialResponse(response){
  const payload = decodeJwt(response.credential);
  currentUser = { id: payload.sub };
  document.getElementById("status").textContent = "Authenticated. You may etch an entry.";
  document.getElementById("submit").disabled = false;
}

/* =========================
   Safer rendering helpers
========================= */
const feedEl = document.getElementById("feed");
function el(tag, cls, text){
  const node = document.createElement(tag);
  if(cls) node.className = cls;
  if(text !== undefined) node.textContent = text;
  return node;
}

function redact(id){
  if(!currentUser) return;
  const ok = confirm("Delete this entry from the archive?");
  if(!ok) return;
  db.ref("registry/" + id).remove();
}

function renderFeedItem(item){
  const wrap = el("div", "feed-item");

  const meta = el("div", "meta", `${(item.fromDept||"").toUpperCase()} ‚Üí ${(item.toDept||"").toUpperCase()}`);
  const quote = el("div", "quote", `"${item.message || ""}"`);

  const sigText = item.signature
    ? `For ${item.targetName || ""} ‚Äî ${item.signature}`
    : `For ${item.targetName || ""}`;

  const sig = el("div", "sig", sigText);

  wrap.appendChild(meta);
  wrap.appendChild(quote);
  wrap.appendChild(sig);

  const isOwner = currentUser && item.authorId === currentUser.id;
  if(isOwner){
    const actions = el("div", "actions");
    const btn = el("button", "redact", "DELETE ENTRY");
    btn.addEventListener("click", () => redact(item.id));
    actions.appendChild(btn);
    wrap.appendChild(actions);
  }

  return wrap;
}

/* =========================
   Create entry
========================= */
let lastSubmitAt = 0;

document.getElementById("submit").addEventListener("click", () => {
  if(!currentUser) return;

  const targetName = document.getElementById("recipient").value.trim();
  const message = document.getElementById("msg").value.trim();
  const signature = document.getElementById("signature").value.trim();

  if(!targetName || !message) return;

  const now = Date.now();
  if(now - lastSubmitAt < 1200) return;
  lastSubmitAt = now;

  const newKey = db.ref().child("registry").push().key;

  db.ref("registry/" + newKey).set({
    id: newKey,
    targetName,
    fromDept: document.getElementById("from").value,
    toDept: document.getElementById("to").value,
    message,
    signature: signature ? signature : null,   // ‚úÖ only stored if typed
    authorId: currentUser.id,                  // ‚úÖ used to show delete only to owner
    timestamp: Date.now()
  });

  document.getElementById("recipient").value = "";
  document.getElementById("msg").value = "";
  document.getElementById("signature").value = "";
});

/* =========================
   Live feed + filtering
========================= */
let cachedItems = [];

db.ref("registry").on("value", (snapshot) => {
  const data = snapshot.val();
  cachedItems = data ? Object.values(data).sort((a,b) => (b.timestamp||0) - (a.timestamp||0)) : [];
  paint();
});

function paint(){
  feedEl.innerHTML = "";
  const term = (document.getElementById("search2").value || "").toLowerCase().trim();

  const items = term
    ? cachedItems.filter(i => (JSON.stringify(i).toLowerCase().includes(term)))
    : cachedItems;

  if(items.length === 0){
    const empty = el("div","feed-item");
    empty.appendChild(el("div","meta","ARCHIVE STATUS"));
    empty.appendChild(el("div","quote","\"No matching entries.\""));
    empty.appendChild(el("div","sig","Try a different search phrase."));
    feedEl.appendChild(empty);
    return;
  }

  items.forEach(item => feedEl.appendChild(renderFeedItem(item)));
}

document.getElementById("search2").addEventListener("input", paint);
document.getElementById("search").addEventListener("input", (e) => {
  document.getElementById("search2").value = e.target.value;
  paint();
});
</script>

</body>
</html>
